Return-Path: <linux-xfs-owner@vger.kernel.org>
X-Original-To: lists+linux-xfs@lfdr.de
Delivered-To: lists+linux-xfs@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 6FFAE320EAC
	for <lists+linux-xfs@lfdr.de>; Mon, 22 Feb 2021 01:17:25 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229996AbhBVARY (ORCPT <rfc822;lists+linux-xfs@lfdr.de>);
        Sun, 21 Feb 2021 19:17:24 -0500
Received: from youngberry.canonical.com ([91.189.89.112]:44104 "EHLO
        youngberry.canonical.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229962AbhBVARY (ORCPT
        <rfc822;linux-xfs@vger.kernel.org>); Sun, 21 Feb 2021 19:17:24 -0500
Received: from 1.general.vorlon.us.vpn ([10.172.64.74] helo=homer.dodds.net)
        by youngberry.canonical.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
        (Exim 4.86_2)
        (envelope-from <steve.langasek@canonical.com>)
        id 1lDyu1-0006Ml-OR; Mon, 22 Feb 2021 00:16:42 +0000
Received: by homer.dodds.net (Postfix, from userid 1000)
        id 87C33EE6; Sun, 21 Feb 2021 16:16:39 -0800 (PST)
Date:   Sun, 21 Feb 2021 16:16:39 -0800
From:   Steve Langasek <steve.langasek@canonical.com>
To:     Dave Chinner <david@fromorbit.com>
Cc:     Bastian Germann <bastiangermann@fishpost.de>,
        linux-xfs@vger.kernel.org
Subject: Re: [PATCH 3/4] debian: Regenerate config.guess using debhelper
Message-ID: <20210222001639.GA1737229@homer.dodds.net>
References: <20210220121610.3982-1-bastiangermann@fishpost.de>
 <20210220121610.3982-4-bastiangermann@fishpost.de>
 <20210221041139.GL4662@dread.disaster.area>
 <840CCF3D-7A20-4E35-BA9C-DEC9C05EE70A@canonical.com>
 <20210221220443.GO4662@dread.disaster.area>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha512;
        protocol="application/pgp-signature"; boundary="OXfL5xGRrasGEqWY"
Content-Disposition: inline
In-Reply-To: <20210221220443.GO4662@dread.disaster.area>
Precedence: bulk
List-ID: <linux-xfs.vger.kernel.org>
X-Mailing-List: linux-xfs@vger.kernel.org


--OXfL5xGRrasGEqWY
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Mon, Feb 22, 2021 at 09:04:43AM +1100, Dave Chinner wrote:

> > This upstream release ended up with an older version of config.guess in
> > the tarball.  Specifically, it was too old to recognize RISC-V as an
> > architecture.

> So was the RISC-V architecture added to the ubuntu build between the
> uploads of the previous version of xfsprogs and xfsprogs-5.10.0? Or
> is this an actual regression where the maintainer signed tarball had
> RISC-V support in it and now it doesn't?

This is a regression.  The previous tarball (5.6.0) had a newer config.guess
that recognized RISC-V, the newer one (5.10.0) had an older config.guess.

> FWIW, where are you getting the tarballs from? Are you downloading
> the maintainer signed tarballs from here:

> https://mirrors.edge.kernel.org/pub/linux/utils/fs/xfs/xfsprogs/

> Or pulling the git.kernel.org built tarball that is autogenerated
> from the release tag?

I don't know the answer to this; we in Ubuntu take the tarballs from Debian.

> > >>  	@echo "=3D=3D dpkg-buildpackage: configure" 1>&2
> > >>  	$(checkdir)
> > >>  	AUTOHEADER=3D/bin/true dh_autoreconf
> > >> +	dh_update_autotools_config
> > >>  	$(options) $(MAKE) $(PMAKEFLAGS) include/platform_defs.h

> > >Why would running at tool that does a search-n-replace of built
> > >config.guess files do anything when run before the build runs
> > >libtoolize to copy in the config.guess file it uses? I'm a bit
> > >confused by this...

> > Autoreconf was not copying in a newer version of config.guess from the
> > system, because of the specific subset of autotools used by this
> > project.

> That sounds wrong. AIUI, autoreconf doesn't copy in anything.

> $ man 7 dh-autoreconf
> ....
> CAVEATS
>        dh_autoreconf is mostly a superset of the
>        dh_update_autotools_config debhelper command included in
>        debhelper since version 9.20160115. When using the dh
>        sequencer, dh_update_autotools_config is run before
>        dh_autoreconf and updates the config.guess and config.sub
>        files. This is required in cases where autoreconf does not
>        update config.guess and config.sub itself.

> So isn't the dh_update_autotools_config call in the wrong place
> here?

Documentation notwithstanding, dh_autoreconf was definitively NOT copying in
the newer config.guess, and we have the build logs to prove it.

https://launchpad.net/ubuntu/+source/xfsprogs/5.10.0-2ubuntu1/+build/209520=
06

I don't know in what sense this would be the "wrong" place to call it,
because it fixes the build failure, which is what I care about.

--=20
Steve Langasek                   Give me a lever long enough and a Free OS
Debian Developer                   to set it on, and I can move the world.
Ubuntu Developer                                   https://www.debian.org/
slangasek@ubuntu.com                                     vorlon@debian.org

--OXfL5xGRrasGEqWY
Content-Type: application/pgp-signature; name="signature.asc"

-----BEGIN PGP SIGNATURE-----

iQIzBAABCgAdFiEErEg/aN5yj0PyIC/KVo0w8yGyEz0FAmAy9+EACgkQVo0w8yGy
Ez0nHhAAzh6MlCL05CepDzy86YWlgUGX2QAQhs5Fwu5P/T1WKno2dwT7JNz8MeJC
0128BrA8LrOT54yg4QPZ7EKEGc6Tu7b6OxZKQif+EyS5e8rqYFFJeF9QNkYirasT
GoROhQIJkssfXLeOQo1xRSvYOuCOtw7yFiUeQ37/hdQrxtKMc49MIZ6WFORtXJ5Y
eRqFJaIHLTDOWgmK9pEvLlryagKRsKm/mzIZolQEe+redkWl7hvWd9beuSyVQlp+
Ou+eBxcHNI0qRjp4OWXgQggpN5mmtBiL0ETxQUdn0hqq/FTgyz/dxYMXfVca3w7V
zw+uyffXgvKy4Mep523671O2x0JTf9Zf6qCNuww9R4IUCDmxY6VmHFkpHDQ8dxco
08WYbEjyPOxDgrpam461vy73+63zTQq6DSuPQeLIGScDEyPjQhB1+yzYIkrNvDM4
Yo+GerRuAwAy/Y77zM+LvE5EZAZC2RmrEjWh60a4eDmNGHvSQ5ur05PXVJoU0vBE
0F0rAACHfrUT4IQqg+epIPe/kiaJODQCDQ5ZsD0KAYffN3WCWiySjsFWKUp0tszB
oLUvSxjeOskLKnbXz+eWLLOZSi/EhGf4dwnDeCG2wQ5LiQ+kaCn8RNnHxbWAzrc1
tLLhFLm3dMXuY+EfjFWX0F1m+0Jz8QEprwclqgp5BfysMReuuzM=
=Xb3n
-----END PGP SIGNATURE-----

--OXfL5xGRrasGEqWY--
